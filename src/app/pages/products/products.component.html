<!-- Fondo animado igual que en home -->
<div class="animated-background">
  <div class="box">
    <div></div>
    <div></div>
    <div></div>
    <div></div>
    <div></div>
    <div></div>
    <div></div>
    <div></div>
    <div></div>
    <div></div>
  </div>
</div>

<div class="wrapper">
  <section class="productos-section py-5">
    <div class="container">
      <h2 class="text-center mb-4">Nuestros Productos</h2>
      <!-- Barra de tipos de producto -->
      <div class="mb-4 d-flex flex-wrap gap-2 justify-content-center">
        <button class="btn btn-outline-primary btn-sm px-3 py-1" [ngClass]="{active: categoriaSeleccionada === 'todos'}"
          (click)="seleccionarCategoria('todos')">Todos</button>
        <button *ngFor="let cat of categorias" class="btn btn-outline-primary btn-sm px-3 py-1"
          [ngClass]="{active: categoriaSeleccionada === cat.key}"
          (click)="seleccionarCategoria(cat.key)">{{cat.label}}</button>
      </div>
      <div class="row">
        <!-- Botón mostrar filtros en todas las vistas -->
        <div class="col-12 mb-2">
          <button class="btn btn-outline-primary btn-sm d-inline-block d-lg-none" type="button"
            (click)="mostrarFiltrosMovil = true">
            <i class="fa fa-filter me-2"></i>Filtros
          </button>
          <button class="btn btn-outline-primary btn-sm d-none d-lg-block" type="button"
            (click)="mostrarFiltrosPC = true">
            <i class="fa fa-filter me-2"></i>Filtros
          </button>
        </div>
        <!-- Filtros móvil/tablet y PC: componente reutilizable -->
        <app-filtros
          [mostrarFiltrosMovil]="mostrarFiltrosMovil"
          [mostrarFiltrosPC]="mostrarFiltrosPC"
          [categoriaSeleccionada]="categoriaSeleccionada"
          [filtros]="filtros"
          [getMarcasDisponibles]="getMarcasDisponibles.bind(this)"
          [getMaterialesDisponibles]="getMaterialesDisponibles.bind(this)"
          [getFormasDisponibles]="getFormasDisponibles.bind(this)"
          [getColoresDisponibles]="getColoresDisponibles.bind(this)"
          [getColoresLenteDisponibles]="getColoresLenteDisponibles.bind(this)"
          [getTiposLenteDisponibles]="getTiposLenteDisponibles.bind(this)"
          [getFiltrosVisibles]="getFiltrosVisibles.bind(this)"
          (onFiltroChange)="onFiltroChange()"
          (cerrarFiltrosMovil)="mostrarFiltrosMovil = false"
          (cerrarFiltrosPC)="mostrarFiltrosPC = false"
        ></app-filtros>
        <!-- Grid de productos -->
        <div class="col-lg-12 col-md-12">
          <div class="row">
            <!-- Grid de productos -->
            <ng-container *ngIf="productosFiltrados.length > 0; else sinProductos">
              <div
                *ngFor="let producto of productosFiltrados | slice:(currentPage-1)*pageSize:(currentPage-1)*pageSize+pageSize"
                class="col-12 col-sm-6 col-md-4 col-lg-3 mb-4">
                <div class="card h-100 shadow-sm">
                  <img [src]="producto.imagen" class="card-img-top" [alt]="producto.nombre"
                    style="height:180px;object-fit:cover;">
                  <div class="card-body d-flex flex-column">
                    <h5 class="card-title mb-2">{{producto.nombre}}</h5>
                    <p class="card-text mb-1">{{producto.descripcion}}</p>
                    <div class="mb-1"><span class="fw-bold">Marca:</span> {{producto.marca.nombre}}</div>
                    <div class="mb-1"><span class="fw-bold">Precio:</span> {{producto.precio |
                      currency:'COP':'symbol':'1.0-0'}}</div>
                    <div class="mb-1"><span class="fw-bold">Stock:</span> {{producto.stock}}</div>
                    <div class="mt-auto">
                      <button class="btn btn-primary btn-sm w-100">Ver detalle</button>
                    </div>
                  </div>
                </div>
              </div>
            </ng-container>
            <!-- Controles de paginación -->
            <div class="row">
              <div class="col-12 d-flex justify-content-center mt-3">
                <ul class="pagination pagination-sm">
                  <li class="page-item" [class.disabled]="currentPage === 1">
                    <button class="page-link" (click)="prevPage()" [disabled]="currentPage === 1">&laquo;</button>
                  </li>
                  <li class="page-item" *ngFor="let p of pagesArray" [class.active]="currentPage === p">
                    <button class="page-link" (click)="goToPage(p)">{{ p }}</button>
                  </li>
                  <li class="page-item" [class.disabled]="currentPage === totalPages">
                    <button class="page-link" (click)="nextPage()"
                      [disabled]="currentPage === totalPages">&raquo;</button>
                  </li>
                </ul>
              </div>
            </div>
            <ng-template #sinProductos>
              <div class="col-12 text-center py-5">
                <h4 class="text-muted">No hay productos disponibles.</h4>
              </div>
            </ng-template>
          </div>
        </div>
      </div>
    </div>
  </section>
</div>