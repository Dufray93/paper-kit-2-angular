<div class="wrapper">
  <!-- Hero adaptado desde landing.component.html -->
  <div class="position-relative">
    <!-- shape Hero -->
    <section class="section section-lg section-shaped pb-250">
      <div class="shape shape-style-1 shape-default">
        <span></span>
        <span></span>
        <span></span>
        <span></span>
        <span></span>
        <span></span>
        <span></span>
        <span></span>
        <span></span>
      </div>
      <div class="container py-lg-md d-flex">
        <div class="col px-0">
          <div class="row">
            <div class="col-lg-7">
              <h1 class="display-3 text-white">¡Recomienda y gana con Tu Pupila Óptica!</h1>
              <h4 class="lead text-white">Invita a tus amigos a conocer nuestros servicios y ambos recibirán descuentos exclusivos en su próxima compra.</h4>
              <div class="btn-wrapper mt-4">
                <a href="https://wa.me/573160504276?text=Hola,%20quiero%20ser%20parte%20del%20programa%20de%20referidos%20de%20Tu%20Pupila%20Óptica." target="_blank" class="btn btn-success btn-lg btn-icon mb-3 mb-sm-0">
                  <span class="btn-inner--icon"><i class="fa fa-whatsapp"></i></span>
                  <span class="btn-inner--text">Solicitar acceso</span>
                </a>
              </div>
              <div class="hero-benefits mt-4">
                <span class="text-white mr-3"><i class="nc-icon nc-badge"></i> Descuentos acumulables</span>
                <span class="text-white mr-3"><i class="nc-icon nc-diamond"></i> Sin límite de referidos</span>
                <span class="text-white"><i class="nc-icon nc-favourite-28"></i> Premios mensuales</span>
              </div>
            </div>
          </div>
        </div>
      </div>
      <!-- SVG separator personalizado -->
      <div style="width:100%;overflow:hidden;line-height:0;position:absolute;left:0;right:0;bottom:0;z-index:2;">
        <svg viewBox="0 0 1920 180" width="100%" height="140" preserveAspectRatio="none" xmlns="http://www.w3.org/2000/svg" style="display:block;">
          <polygon fill="#fff" points="0,60 1920,0 1920,180 0,180"/>
        </svg>
      </div>
    </section>
    <!-- 1st Hero Variation -->
  </div>
  <!-- Sección de 3 tarjetas con efecto flotante y superposición desde cero -->
  <section class="ref-cards-floating-section">
    <div class="ref-cards-floating-container">
      <div class="ref-card-floating">
        <div class="ref-card-icon" style="background:linear-gradient(135deg,#5bc0be 60%,#e3f6f5 100%)"><i class="nc-icon nc-single-02"></i></div>
        <h5 class="ref-card-title">Invita y gana</h5>
        <p class="ref-card-desc">Comparte tu código con amigos, familiares o clientes. Por cada compra que realicen tus referidos, ¡ganas recompensas!</p>
        <div>
          <span class="badge badge-pill badge-primary">Invita</span>
          <span class="badge badge-pill badge-primary">Comparte</span>
          <span class="badge badge-pill badge-primary">Gana</span>
        </div>
        <a href="#como-funciona" class="btn btn-primary mt-4">¿Cómo funciona?</a>
      </div>
      <div class="ref-card-floating">
        <div class="ref-card-icon" style="background:linear-gradient(135deg,#38bdf8 60%,#e3f6f5 100%)"><i class="nc-icon nc-chart-bar-32"></i></div>
        <h5 class="ref-card-title">Multiplica tus ganancias</h5>
        <p class="ref-card-desc">Recibe recompensas no solo por tus referidos directos, sino también por los referidos de tus referidos, hasta 3 niveles.</p>
        <div>
          <span class="badge badge-pill badge-success">Red</span>
          <span class="badge badge-pill badge-success">Niveles</span>
          <span class="badge badge-pill badge-success">Exponencial</span>
        </div>
        <a href="#" class="btn btn-success mt-4">Ver beneficios</a>
      </div>
      <div class="ref-card-floating">
        <div class="ref-card-icon" style="background:linear-gradient(135deg,#fb6340 60%,#fbb140 100%)"><i class="nc-icon nc-money-coins"></i></div>
        <h5 class="ref-card-title">Canjea tus recompensas</h5>
        <p class="ref-card-desc">Acumula puntos y dinero por cada compra en tu red y canjéalos por productos, servicios o premios exclusivos.</p>
        <div>
          <span class="badge badge-pill badge-warning">Puntos</span>
          <span class="badge badge-pill badge-warning">Premios</span>
          <span class="badge badge-pill badge-warning">Canjea</span>
        </div>
        <a href="#" class="btn btn-warning mt-4 text-white">Ver catálogo</a>
      </div>
    </div>
  </section>
  <!-- Fin sección 3 tarjetas -->
  <!-- Aquí comienza el rediseño. Sección "¿Cómo funciona?" conservada para referencia. -->
  <main>
    <section class="section section-referrals-info pt-0">
      <div class="container-fluid">
        <div class="row justify-content-center mb-4">
          <div class="col-lg-8 col-md-10">
            <div class="card card-steps-referrals p-4 mb-3 shadow-sm">
              <h2 class="mb-4 fw-bold text-primary text-center"><i class="nc-icon nc-bulb-63 me-2"></i>¿Cómo funciona?</h2>
              <div class="row row-cols-1 row-cols-md-3 g-3 mb-3 steps-benefits-grid">
                <div class="col d-flex">
                  <div class="step-benefit-card flex-fill text-center p-3">
                    <div class="step-icon mb-2"><span>1</span></div>
                    <div class="step-title">Comparte tu código</div>
                    <div class="step-desc">Invita a amigos, familiares o clientes. Encuentra tu código en tu perfil o correo.</div>
                  </div>
                </div>
                <div class="col d-flex">
                  <div class="step-benefit-card flex-fill text-center p-3">
                    <div class="step-icon mb-2"><span>2</span></div>
                    <div class="step-title">Ellos se registran y compran</div>
                    <div class="step-desc">Tus referidos usan tu código y realizan compras. ¡Sin límite de referidos!</div>
                  </div>
                </div>
                <div class="col d-flex">
                  <div class="step-benefit-card flex-fill text-center p-3">
                    <div class="step-icon mb-2"><span>3</span></div>
                    <div class="step-title">Ganas recompensas</div>
                    <div class="step-desc">Recibe dinero, puntos y premios por cada compra en tu red, hasta 3 niveles.</div>
                  </div>
                </div>
                <div class="col d-flex">
                  <div class="step-benefit-card flex-fill text-center p-3">
                    <div class="step-icon mb-2"><span>4</span></div>
                    <div class="step-title">Acumula y canjea</div>
                    <div class="step-desc">Suma puntos y dinero para canjear o usar en la óptica.</div>
                  </div>
                </div>
                <div class="col d-flex">
                  <div class="step-benefit-card flex-fill text-center p-3">
                    <div class="step-icon mb-2"><span>5</span></div>
                    <div class="step-title">¡Sigue creciendo!</div>
                    <div class="step-desc">Motiva a tus referidos a invitar y multiplica tus ganancias. ¡Crecimiento exponencial!</div>
                  </div>
                </div>
              </div>
              <div class="text-muted small text-center mb-4">Sin costo, sin riesgos. ¡Solo por recomendar!</div>
              <h3 class="mb-3 fw-bold text-primary text-center"><i class="nc-icon nc-zoom-split me-1"></i>Consulta tus referidos</h3>
              <form class="referral-query-form" autocomplete="off" (ngSubmit)="onQuery(referralInput.value)">
                <div class="input-group mb-3">
                  <label for="referralInput" class="visually-hidden">Código o email</label>
                  <input id="referralInput" #referralInput type="text" class="form-control" placeholder="Ingresa tu código de referido o email" aria-label="Código o email" required [disabled]="loading">
                  <button class="btn btn-primary btn-round ms-2" type="submit" [disabled]="loading"><i class="nc-icon nc-zoom-split"></i> Buscar</button>
                  <button type="button" class="btn btn-outline-secondary btn-round ms-2" (click)="setExampleResult()" [disabled]="loading" title="Cargar ejemplo">
                    <i class="nc-icon nc-settings-gear-65"></i> Ejemplo
                  </button>
                </div>
                <small class="text-muted">Tu código está en tu perfil o correo de bienvenida.</small>
                <div class="form-text mt-1"><a href="#" tabindex="0">¿No tienes tu código? Haz clic aquí</a></div>
              </form>
              <div *ngIf="loading" class="text-center my-3">
                <div class="spinner-border text-primary" role="status"><span class="visually-hidden">Cargando...</span></div>
              </div>
              <div *ngIf="error && !loading" class="alert alert-danger mt-3">{{ error }}</div>
              <div class="referral-query-result mt-3" *ngIf="result && !loading">
                <div class="alert alert-success d-flex align-items-center gap-2" role="alert">
                  <i class="nc-icon nc-single-02"></i>
                  <div>
                    <strong>{{ result.user.name }}</strong> ({{ result.user.email }})<br>
                    Código: <span class="text-primary">{{ result.user.referralCode }}</span> | Puntos: <b>{{ result.user.points }}</b> | Ganancias: <b>${{ result.user.totalEarnings | number:'1.2-2' }}</b>
                  </div>
                </div>
                <div *ngIf="result.referrals && result.referrals.length > 0">
                  <h6 class="mt-3 mb-2">Referidos activos:</h6>
                  <ul class="list-group small mb-0">
                    <li class="list-group-item d-flex justify-content-between align-items-center" *ngFor="let r of result.referrals | slice:(refPage-1)*10:(refPage-1)*10+10; let i = index">
                      <span><i class="nc-icon nc-single-02 me-1"></i> {{ r.name }} <span class="text-muted">({{ r.email }})</span></span>
                      <span class="badge bg-success" *ngIf="r.level === 1">Nivel 1</span>
                      <span class="badge bg-info" *ngIf="r.level === 2">Nivel 2</span>
                      <span class="badge bg-warning" *ngIf="r.level === 3">Nivel 3</span>
                    </li>
                  </ul>
                  <nav *ngIf="result.referrals.length > 10" class="mt-2">
                    <ul class="pagination justify-content-center pagination-sm">
                      <li class="page-item" [class.disabled]="refPage === 1">
                        <button class="page-link" (click)="prevPage()" [disabled]="refPage === 1">&laquo;</button>
                      </li>
                      <li class="page-item" *ngFor="let p of pagesArray; let idx = index" [class.active]="refPage === p">
                        <button class="page-link" (click)="goToPage(p)">{{ p }}</button>
                      </li>
                      <li class="page-item" [class.disabled]="refPage === totalPages">
                        <button class="page-link" (click)="nextPage()" [disabled]="refPage === totalPages">&raquo;</button>
                      </li>
                    </ul>
                  </nav>
                </div>
                <div *ngIf="result.referrals && result.referrals.length === 0" class="text-muted mt-2">No tienes referidos activos aún.</div>
                <div *ngIf="result.rewards && result.rewards.length > 0">
                  <h6 class="mt-4 mb-2">Últimas recompensas:</h6>
                  <ul class="list-group small mb-0">
                    <li class="list-group-item d-flex justify-content-between align-items-center" *ngFor="let rw of result.rewards | slice:0:5">
                      <span><i class="nc-icon nc-money-coins me-1"></i> {{ rw.amount | currency:'USD':'symbol':'1.2-2' }} - Nivel {{ rw.level }}</span>
                      <span class="text-muted">{{ rw.createdAt | date:'short' }}</span>
                    </li>
                  </ul>
                </div>
              </div>
              <div class="admin-access text-center mt-2 d-flex justify-content-center gap-3">
                <a routerLink="/auth/login" class="admin-link" title="Acceso administrador" style="color:#5bc0be; font-weight:500;">
                  <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="#5bc0be" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="11" width="18" height="10" rx="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></svg>
                  <span>Acceso administrador</span>
                </a>
                <a routerLink="/auth/register" class="admin-link" title="Registro de usuario" style="color:#38bdf8; font-weight:500;">
                  <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="#38bdf8" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="7" r="4"/><path d="M5.5 21h13a2 2 0 0 0 2-2v-1a7 7 0 0 0-14 0v1a2 2 0 0 0 2 2z"/><line x1="20" y1="8" x2="20" y2="14"/><line x1="23" y1="11" x2="17" y2="11"/></svg>
                  <span>Registro</span>
                </a>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>
  </main>
</div>

