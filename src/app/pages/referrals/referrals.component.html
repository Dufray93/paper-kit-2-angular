<div class="wrapper">
  <div class="page-header section-dark" style="background-image: url('assets/img/antoine-barres.jpg')">
    <div class="filter"></div>
    <div class="content-center">
      <div class="container-fluid">
        <div class="title-brand">
          <div class="angular-logo">
            <img src="assets/img/angular2-logo.png" alt="Logo">
          </div>
          <h1 class="presentation-title">Sistema de Referidos</h1>
          <div class="fog-low">
            <img src="assets/img/fog-low.png" alt="">
          </div>
          <div class="fog-low right">
            <img src="assets/img/fog-low.png" alt="">
          </div>
        </div>
        <h4 class="presentation-subtitle text-center">Gana recompensas invitando y construyendo tu red</h4>
        <div class="d-flex justify-content-center mt-3">
          <button class="hero-cta-btn" onclick="document.getElementById('referralInput').focus()">¡Comienza ahora!</button>
        </div>
      </div>
    </div>
    <div class="moving-clouds" style="background-image: url('assets/img/clouds.png'); "></div>
  </div>
  <div class="main">
    <div class="section section-referrals-info">
      <div class="container-fluid">
        <div class="row justify-content-center mb-4">
          <div class="col-lg-6 col-md-8">
            <div class="card card-info text-center p-4 mb-3">
              <h3 class="mb-2">¿Cómo funciona?</h3>
              <p class="lead mb-3">Invita, comparte y gana recompensas reales por cada compra en tu red. ¡Entre más refieras, más ganas!</p>
              <ul class="list-unstyled mb-0 text-start mx-auto" style="max-width: 420px;">
                <li class="mb-2"><span class="step-icon">1</span> <strong>Comparte tu código único</strong> con amigos, familiares o clientes. Puedes encontrarlo en tu perfil o correo de bienvenida.</li>
                <li class="mb-2"><span class="step-icon">2</span> <strong>Ellos se registran y compran</strong> usando tu código. ¡No hay límite de referidos!</li>
                <li class="mb-2"><span class="step-icon">3</span> <strong>Ganas recompensas</strong> automáticas por cada compra en tu red, hasta 3 niveles de profundidad.</li>
                <li class="mb-2"><span class="step-icon">4</span> <strong>Acumula puntos y dinero</strong> que puedes canjear o usar en la óptica.</li>
                <li><span class="step-icon">5</span> <strong>¡Sigue creciendo!</strong> Motiva a tus referidos a invitar y multiplica tus ganancias.</li>
              </ul>
              <div class="mt-3 text-muted small">Sin costo, sin riesgos. ¡Solo por recomendar!</div>
            </div>
          </div>
          <div class="col-lg-6 col-md-8 d-flex align-items-center justify-content-center">
            <div class="card card-graphic p-3 text-center">
              <img src="assets/img/popayan.jpg" alt="Red de referidos" class="img-fluid mx-auto d-block" style="max-width: 400px; border-radius: 1rem; box-shadow: 0 2px 16px #0001;">
              <div class="text-center mt-2 small text-muted">Ejemplo visual: así crece tu red de referidos</div>
            </div>
          </div>
        </div>
        <!-- Bloque de beneficios mejorado -->
        <div class="row justify-content-center mb-5">
          <div class="col-lg-10">
            <div class="benefits-block d-flex flex-wrap justify-content-center gap-4 py-3">
              <div class="benefit-item text-center">
                <div class="benefit-icon mb-2 animate-hover" tabindex="0" aria-label="Gana dinero real"><i class="nc-icon nc-money-coins"></i></div>
                <div class="benefit-title">Gana dinero real</div>
                <div class="benefit-desc">Recibe recompensas por cada compra en tu red.</div>
              </div>
              <div class="benefit-item text-center">
                <div class="benefit-icon mb-2 animate-hover" tabindex="0" aria-label="Sin límite de referidos"><i class="nc-icon nc-favourite-28"></i></div>
                <div class="benefit-title">Sin límite de referidos</div>
                <div class="benefit-desc">Invita a todos los que quieras, ¡sin restricciones!</div>
              </div>
              <div class="benefit-item text-center">
                <div class="benefit-icon mb-2 animate-hover" tabindex="0" aria-label="Premios y puntos"><i class="nc-icon nc-badge"></i></div>
                <div class="benefit-title">Premios y puntos</div>
                <div class="benefit-desc">Acumula puntos y canjéalos por productos o servicios.</div>
              </div>
              <div class="benefit-item text-center">
                <div class="benefit-icon mb-2 animate-hover" tabindex="0" aria-label="Crecimiento exponencial"><i class="nc-icon nc-planet"></i></div>
                <div class="benefit-title">Crecimiento exponencial</div>
                <div class="benefit-desc">Tus referidos también pueden invitar y multiplicar tus ganancias.</div>
              </div>
            </div>
          </div>
        </div>
        <!-- Consulta de referidos mejorada -->
        <div class="row justify-content-center">
          <div class="col-lg-7 col-md-10">
            <div class="card card-query p-4 mb-3">
              <h4 class="mb-3">Consulta tus referidos</h4>
              <form class="referral-query-form" autocomplete="off" (ngSubmit)="onQuery(referralInput.value)">
                <div class="input-group mb-3">
                  <label for="referralInput" class="visually-hidden">Código o email</label>
                  <input id="referralInput" #referralInput type="text" class="form-control" placeholder="Ingresa tu código de referido o email" aria-label="Código o email" required [disabled]="loading">
                  <button class="btn btn-primary btn-round ms-2" type="submit" [disabled]="loading"><i class="nc-icon nc-zoom-split"></i> Buscar</button>
                </div>
                <small class="text-muted">Recuerda: tu código de referido lo encuentras en tu perfil o en tu correo de bienvenida.</small>
                <div class="form-text mt-1"><a href="#" tabindex="0">¿No tienes tu código? Haz clic aquí</a></div>
              </form>
              <!-- Feedback de carga y error -->
              <div *ngIf="loading" class="text-center my-3">
                <div class="spinner-border text-primary" role="status"><span class="visually-hidden">Cargando...</span></div>
              </div>
              <div *ngIf="error && !loading" class="alert alert-danger mt-3">{{ error }}</div>
              <!-- Resultados reales -->
              <div class="referral-query-result mt-3" *ngIf="result && !loading">
                <div class="alert alert-success d-flex align-items-center gap-2" role="alert">
                  <i class="nc-icon nc-single-02"></i>
                  <div>
                    <strong>{{ result.user.name }}</strong> ({{ result.user.email }})<br>
                    Código: <span class="text-primary">{{ result.user.referralCode }}</span> | Puntos: <b>{{ result.user.points }}</b> | Ganancias: <b>${{ result.user.totalEarnings | number:'1.2-2' }}</b>
                  </div>
                </div>
                <div *ngIf="result.referrals && result.referrals.length > 0">
                  <h6 class="mt-3 mb-2">Referidos activos:</h6>
                  <ul class="list-group small mb-0">
                    <li class="list-group-item d-flex justify-content-between align-items-center" *ngFor="let r of result.referrals | slice:(refPage-1)*10:(refPage-1)*10+10; let i = index">
                      <span><i class="nc-icon nc-single-02 me-1"></i> {{ r.name }} <span class="text-muted">({{ r.email }})</span></span>
                      <span class="badge bg-success" *ngIf="r.level === 1">Nivel 1</span>
                      <span class="badge bg-info" *ngIf="r.level === 2">Nivel 2</span>
                      <span class="badge bg-warning" *ngIf="r.level === 3">Nivel 3</span>
                    </li>
                  </ul>
                  <nav *ngIf="result.referrals.length > 10" class="mt-2">
                    <ul class="pagination justify-content-center pagination-sm">
                      <li class="page-item" [class.disabled]="refPage === 1">
                        <button class="page-link" (click)="prevPage()" [disabled]="refPage === 1">&laquo;</button>
                      </li>
                      <li class="page-item" *ngFor="let p of pagesArray; let idx = index" [class.active]="refPage === p">
                        <button class="page-link" (click)="goToPage(p)">{{ p }}</button>
                      </li>
                      <li class="page-item" [class.disabled]="refPage === totalPages">
                        <button class="page-link" (click)="nextPage()" [disabled]="refPage === totalPages">&raquo;</button>
                      </li>
                    </ul>
                  </nav>
                </div>
                <div *ngIf="result.referrals && result.referrals.length === 0" class="text-muted mt-2">No tienes referidos activos aún.</div>
                <div *ngIf="result.rewards && result.rewards.length > 0">
                  <h6 class="mt-4 mb-2">Últimas recompensas:</h6>
                  <ul class="list-group small mb-0">
                    <li class="list-group-item d-flex justify-content-between align-items-center" *ngFor="let rw of result.rewards | slice:0:5">
                      <span><i class="nc-icon nc-money-coins me-1"></i> {{ rw.amount | currency:'USD':'symbol':'1.2-2' }} - Nivel {{ rw.level }}</span>
                      <span class="text-muted">{{ rw.createdAt | date:'short' }}</span>
                    </li>
                  </ul>
                </div>
              </div>
              <!-- Ejemplo visual de resultado en móvil -->
              <div class="referral-query-result mt-3 d-block d-md-none" style="border:1px dashed #5bc0be; border-radius:1rem; background:#f7fafc; padding:1rem; margin-bottom:1.5rem;">
                <div class="alert alert-success d-flex align-items-center gap-2" role="alert">
                  <i class="nc-icon nc-single-02"></i>
                  <div>
                    <strong>María López</strong> (maria&#64;correo.com)<br>
                    Código: <span class="text-primary">XYZ789</span> | Puntos: <b>320</b> | Ganancias: <b>$45.00</b>
                  </div>
                </div>
                <h6 class="mt-3 mb-2">Referidos activos:</h6>
                <ul class="list-group small mb-0">
                  <li class="list-group-item d-flex justify-content-between align-items-center">
                    <span><i class="nc-icon nc-single-02 me-1"></i> Juan Pérez <span class="text-muted">(juan&#64;correo.com)</span></span>
                    <span class="badge bg-success">Nivel 1</span>
                  </li>
                  <li class="list-group-item d-flex justify-content-between align-items-center">
                    <span><i class="nc-icon nc-single-02 me-1"></i> Ana Gómez <span class="text-muted">(ana&#64;correo.com)</span></span>
                    <span class="badge bg-info">Nivel 2</span>
                  </li>
                </ul>
                <nav class="mt-2">
                  <ul class="pagination justify-content-center pagination-sm mb-0">
                    <li class="page-item disabled"><button class="page-link">&laquo;</button></li>
                    <li class="page-item active"><button class="page-link">1</button></li>
                    <li class="page-item"><button class="page-link">2</button></li>
                    <li class="page-item"><button class="page-link">&raquo;</button></li>
                  </ul>
                  <div class="text-center text-muted small">Mostrando 1-2 de 12 referidos</div>
                </nav>
                <h6 class="mt-4 mb-2">Últimas recompensas:</h6>
                <ul class="list-group small mb-0">
                  <li class="list-group-item d-flex justify-content-between align-items-center">
                    <span><i class="nc-icon nc-money-coins me-1"></i> $10.00 - Nivel 1</span>
                    <span class="text-muted">09/07/2025 10:00</span>
                  </li>
                  <li class="list-group-item d-flex justify-content-between align-items-center">
                    <span><i class="nc-icon nc-money-coins me-1"></i> $5.00 - Nivel 2</span>
                    <span class="text-muted">08/07/2025 15:30</span>
                  </li>
                </ul>
              </div>
            </div>
            <div class="admin-access text-center mt-2">
              <a href="#" class="admin-link" title="Acceso administrador" style="color:#5bc0be; font-weight:500;">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="#5bc0be" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="11" width="18" height="10" rx="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></svg>
                <span>Acceso administrador</span>
              </a>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <!-- Separador SVG -->
  <svg class="separator-svg" viewBox="0 0 1440 48" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill="#fff" fill-opacity="1" d="M0,32L48,26.7C96,21,192,11,288,10.7C384,11,480,21,576,32C672,43,768,53,864,53.3C960,53,1056,43,1152,32C1248,21,1344,11,1392,5.3L1440,0V48H1392C1344,48,1248,48,1152,48C1056,48,960,48,864,48C768,48,672,48,576,48C480,48,384,48,288,48C192,48,96,48,48,48H0V32Z"></path></svg>
</div>
